/*
	Project follows MyGOVEA design principles and MYDS tokens.
	Conventions:
	- Use semantic tokens via CSS custom properties in `_myds-variables.scss`.
	- Keep components accessible (ARIA, keyboard nav, focus-visible)
	- Prefer no inline styles; use utility classes in this stylesheet.
*/

// Variables (module) - must come before any CSS rules or @import statements
@use 'variables' as *;
// MYDS token partial (exported CSS custom properties)
@use 'myds-variables' as *;
// Bootstrap wrapper (module-based)
@use 'bootstrap-wrapper';

/* Import MYDS full stylesheet so token variables and base styles are available */
@import "@govtechmy/myds-style/full.css";

// Fonts (keep as a plain CSS import)
@import url('https://fonts.bunny.net/css?family=Poppins:400,500,600|Inter:400,500');

/*
MYDS CSS custom properties (tokens).
Defined here so runtime theme switching via [data-theme] can swap values.
Fallbacks use SASS variables where available to remain compatible with the existing
SASS architecture.
*/
:root {
	/* Font tokens (MYDS) */
	--font-body: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
	--font-heading: 'Poppins', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
	/* MYDS Primitive / brand tokens (RGB values without hex) */
	--primary: rgb(58, 117, 246); /* MYDS primary-500 */
	--danger: rgb(220, 38, 38); /* danger-600 */
	--success: rgb(22, 163, 74); /* success-600 */
	--warning: rgb(202, 138, 4); /* warning-600 */

	/* MYDS Light mode semantic background tokens */
	--bg-page: rgb(250, 250, 250); /* gray-50 */
	--bg-surface: rgb(255, 255, 255); /* white */
	--bg-muted: rgb(244, 244, 245); /* gray-100 / washed */

	/* MYDS Light mode text semantic tokens */
	--txt-primary: rgb(24, 24, 27); /* gray-900 */
	--txt-muted: rgb(107, 107, 116); /* gray-500 */
	--txt-disabled: rgb(82, 82, 91); /* gray-600 per MYDS text disabled (light) */

	/* Outlines / focus */
	--otl-default: rgba(15,23,42,0.06);
	/* Focus ring uses MYDS primary-300 at 40% opacity for accessibility */
	--fr: rgba(150, 183, 255, 0.4);
	--fr-shadow: rgba(150, 183, 255, 0.12);

	/* Motion */
	--motion-short: 200ms;
	--motion-medium: 400ms;
	--motion-long: 600ms;

	/* Radius */
	--radius-xs: 4px;
	--radius-s: 6px;
	--radius-m: 8px;
	--radius-l: 12px;
	--radius-xl: 14px;

	/* MYDS-compliant text-on-primary token */
	--txt-on-primary: rgb(255, 255, 255);
	--otl-primary: rgba(58, 117, 246, 0.12);
	--bg-primary-surface: var(--primary);
}

/* Dark theme token overrides */
[data-theme="dark"] {
	/* MYDS Dark theme primary accent tokens (mapped to lighter variants) */
	--primary: rgb(99, 148, 255); /* primary-400 mapped for dark surfaces */
	--danger: rgb(248, 113, 113); /* danger-400/darker accent */
	--success: rgb(45, 212, 191); /* success-400 */
	--warning: rgb(245, 158, 11); /* warning-400 */

	--bg-page: rgb(22, 22, 25); /* gray-930 */
	--bg-surface: rgb(29, 29, 33); /* gray-850 */
	--bg-muted: rgb(39, 39, 42); /* gray-800 */

	--txt-primary: rgb(255, 255, 255); /* text on dark */
	--txt-muted: rgb(212, 212, 216); /* gray-300 */
	--txt-disabled: rgb(161, 161, 170); /* gray-400 per MYDS text disabled (dark) */

	--otl-default: rgba(255,255,255,0.04);
	/* Focus ring per MYDS: primary-700 at 40% */
	--fr: rgba(29,78,216,0.4);
	--fr-shadow: rgba(29,78,216,0.12);
}

// MYDS-style focus ring utility using tokens
.focus-ring {
	outline: 2px solid var(--fr) !important;
	outline-offset: 2px !important;
	box-shadow: 0 0 0 4px var(--fr-shadow) !important;
}

/* Visually hidden utility for ARIA live regions and screen-reader-only text */
.visually-hidden {
	position: absolute !important;
	width: 1px; height: 1px;
	padding: 0; margin: -1px;
	overflow: hidden; clip: rect(0 0 0 0);
	white-space: nowrap; border: 0;
}

/* Skip link per MyGOVEA: accessible, off-screen until focused */
.myds-skip-link {
	position: absolute;
	left: -999px;
	top: auto;
	background: var(--myds-skip-bg, var(--bg-surface));
	color: var(--txt-primary);
	padding: 0.5rem 0.75rem;
	border-radius: 0.25rem;
	z-index: 9999;
}
.myds-skip-link:focus, .myds-skip-link:active {
	left: 1rem; top: 1rem;
}

/* Tap target helper to ensure 48x48 touch targets per MYDS guidelines */
.myds-tap-target {
	min-width: 48px;
	min-height: 48px;
	display: inline-flex;
	align-items: center;
	justify-content: center;
}

/*
  MYDS Grid System (12 - Desktop, 8 - Tablet, 4 - Mobile)
  - Use `.myds-grid` as the grid container.
  - Children can set column span using `.myds-col-span-N` (N from 1..12).
  - Use `.myds-container` to constrain article/content widths per MYDS guidance.
*/
.myds-container {
	width: 100%;
	margin-left: auto;
	margin-right: auto;
	padding-left: 1rem;
	padding-right: 1rem;
	max-width: 1200px; /* sensible page max — article content constrained further by helpers */
}

.myds-grid {
	display: grid;
	gap: 1.5rem;
	/* Default to desktop 12-column layout */
	grid-template-columns: repeat(12, 1fr);
}

/* Tablet (768 - 1023) map to 8 columns */
@media (max-width: 1023px) and (min-width: 768px) {
	.myds-grid { grid-template-columns: repeat(8, 1fr); }
}

/* Mobile (<= 767) map to 4 columns */
@media (max-width: 767px) {
	.myds-grid { grid-template-columns: repeat(4, 1fr); }
}

/* Column span utilities: simple, responsive-friendly approach
   Use the same classes across breakpoints — values > available columns simply clamp. */
@for $i from 1 through 12 {
	.myds-col-span-#{$i} { grid-column: span #{$i} / auto; }
}

/* Ensure interactive elements meet 48x48 touch targets on coarse pointers (mobile & touch devices) */
@media (pointer: coarse) {
	a, button, .btn, .myds-btn, .nav-link, .dropdown-item, .list-group-item-action, [role="button"] {
		min-width: 48px !important;
		min-height: 48px !important;
		padding: max(.375rem, 0.5rem) !important;
		line-height: 1 !important;
		box-sizing: border-box;
	}
}


/* Respect reduced motion preference */
@media (prefers-reduced-motion: reduce) {
	* {
		transition-duration: 0.001ms !important;
		animation-duration: 0.001ms !important;
		scroll-behavior: auto !important;
	}
}

/* Utilities added to replace inline styles found in templates */
.hero-heading-size {
	font-size: 2.5rem;
}

.content-maxwidth {
	max-width: 600px;
}
.content-maxwidth-lg {
	max-width: 760px;
}
.content-maxwidth-xl {
	max-width: 920px;
}

.icon-circle {
	width: 60px;
	height: 60px;
	display: inline-flex;
	align-items: center;
	justify-content: center;
}

.notification-count-badge {
	top: 2px;
	right: 0;
	font-size: 0.6rem;
}

.notifications-menu {
	min-width: 320px;
}

.autocomplete-wrapper { max-width: 420px; }
.autocomplete-list { display: none; position: absolute; z-index: 2000; width: 100%; }

.flex-grow-1 { flex: 1; }
.fixed-width-180 { width: 180px; }

/* Small spacing utilities */
.mt-0 { margin-top: 0 !important; }
.mt-3 { margin-top: 12px !important; }
.mb-0 { margin-bottom: 0 !important; }

/* Cursor utilities */
.cursor-not-allowed { cursor: not-allowed !important; }

/* When JS wants to show autocomplete results it removes 'display:none' inline state; ensure visible state class exists */
.autocomplete-list.show { display: block !important; }

// Global focus style for interactive elements (use :focus-visible)
// Apply to most interactive and tabbable controls, including ARIA roles.
:is(
	a[href],
	button,
	[role="button"],
	input,
	select,
	textarea,
	.btn,
	.myds-btn,
	.nav-link,
	.dropdown-item,
	.list-group-item-action,
	.page-link,
	[role="menuitem"],
	[role="radio"],
	[role="checkbox"],
	[tabindex]:not([tabindex="-1"])
):focus-visible {
	outline: 2px solid var(--fr) !important;
	outline-offset: 2px !important;
	box-shadow: 0 0 0 4px var(--fr-shadow) !important;
	transition: outline-color var(--motion-short);
}

// Hover affordance: show a subtle ring on hover for most interactive elements
:is(
	a[href],
	button,
	[role="button"],
	[role="link"],
	.btn,
	.myds-btn,
	.nav-link,
	.dropdown-item,
	.list-group-item-action,
	.page-link,
	input,
	select,
	textarea
):not(:disabled):not([aria-disabled="true"]):not([readonly]):hover {
	box-shadow: 0 0 0 2px var(--fr-shadow);
}

// MYDS button utilities
.myds-btn{
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding: .375rem .75rem;
	border-radius: .25rem;
	font-size: .875rem;
	line-height: 1;
	cursor: pointer;
	text-decoration: none;
	transition: background-color var(--motion-short) ease, color var(--motion-short) ease, box-shadow var(--motion-short) ease, border-color var(--motion-short) ease;
}
.myds-btn--primary{
	background-color: var(--primary);
	color: var(--txt-on-primary);
	border: 1px solid var(--otl-default);
}
.myds-btn--secondary{
	background-color: transparent;
	color: var(--txt-primary);
	border: 1px solid var(--otl-primary);
}
.myds-btn--danger{
	background-color: var(--danger);
	color: rgb(255, 255, 255);
	border: 1px solid var(--otl-default);
}
.myds-btn--success{
	background-color: var(--success);
	color: rgb(255, 255, 255);
	border: 1px solid var(--otl-default);
}
.myds-action--danger{ color: var(--danger) !important; }

/* Tertiary button (link-styled button) */
.myds-btn--tertiary{
	background-color: transparent;
	color: var(--primary);
	border: 1px solid transparent;
	padding: 0.25rem 0.25rem; /* tighter like a link */
}
.myds-btn--tertiary:hover{ text-decoration: underline; }

/* View button consistency tweaks used in index tables */
.btn-outline-secondary.myds-btn--secondary {
	padding: .35rem .6rem;
	min-height: 38px;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	gap: .5rem;
}

/* Mobile stacked buttons should expand full width and maintain readable tap targets */
@media (max-width: 576px) {
	.btn-block.myds-btn--secondary {
		display: block !important;
		width: 100% !important;
		min-height: 44px !important;
		padding: .5rem .75rem !important;
	}
}

/* Nav / Brand helpers */
.myds-nav{ background-color: var(--bg-surface); border-bottom: 1px solid var(--otl-default); }
.myds-brand{ color: var(--txt-primary); font-weight: 600; }
.myds-brand:hover{ color: var(--primary); text-decoration: none; }

/* Header search alignment */
.navbar form[role="search"] input[type="search"]{
	min-width: 200px;
}
.navbar .nav-link { color: var(--txt-primary); }
.navbar .nav-link:hover { color: var(--primary); }

/* Dropdown toggle caret/icon visibility tuned for dark and light modes */
.nav-link.dropdown-toggle::after {
	color: var(--txt-primary);
	margin-left: .25rem;
}

/* Active nav item uses primary and a subtle underline per MYDS */
.navbar .nav-link.active, .navbar .nav-link[aria-current="page"] {
	color: var(--primary);
	text-decoration: underline;
}

/* Article container per MYDS (max 640px) */
.myds-article{ max-width: 640px; margin-left: auto; margin-right: auto; }
.myds-media-wide{ max-width: 740px; margin-left: auto; margin-right: auto; }

// Typography defaults
body {
		font-family: var(--font-body);
		background-color: var(--bg-page);
		color: var(--txt-primary);
}

/* Surface tokens */
.card, .card-body, .bg-surface {
	background-color: var(--bg-surface) !important;
	color: var(--txt-primary) !important;
}

/* Muted text */
.text-muted {
	color: var(--txt-muted) !important;
}

/* Navbar mapping */
.navbar, .navbar-light, .navbar-dark {
	background-color: var(--bg-surface) !important;
	border-bottom: 1px solid var(--otl-default);
}

/* Forms */
input, textarea, select {
	background-color: var(--bg-surface);
	color: var(--txt-primary);
	border: 1px solid var(--otl-default);
}

input::placeholder, textarea::placeholder {
	color: var(--txt-muted);
}

/* Buttons */
.btn {
	transition: background-color 180ms ease, color 180ms ease, box-shadow 180ms ease;
	/* Ensure default bootstrap buttons respect MYDS tokens */
	background-color: transparent;
	color: var(--txt-primary);
	border-radius: var(--radius-s);
	border: 1px solid var(--otl-default);
}

/* Primary / secondary / danger / success mapping for Bootstrap classes */
.btn-primary, .btn.btn-primary {
	background-color: var(--primary) !important;
	color: var(--txt-on-primary) !important;
	border-color: var(--otl-primary);
	box-shadow: none;
}
.btn-outline-primary {
	background-color: transparent !important;
	color: var(--primary) !important;
	border: 1px solid var(--otl-primary) !important;
}
.btn-secondary, .btn.btn-secondary {
	background-color: transparent !important;
	color: var(--txt-primary) !important;
	border: 1px solid var(--otl-primary) !important;
}
.btn-outline-secondary {
	background-color: transparent !important;
	color: var(--txt-primary) !important;
	border: 1px solid var(--otl-primary) !important;
}
.btn-danger, .btn.btn-danger, .btn-outline-danger {
	background-color: var(--danger) !important;
	color: rgb(255, 255, 255) !important;
	border: 1px solid rgba(0, 0, 0, 0.08) !important;
}
.btn-success {
	background-color: var(--success) !important;
	color: rgb(255, 255, 255) !important;
	border: 1px solid rgba(0, 0, 0, 0.04) !important;
}

/* Small / block sizing consistent with MYDS tap targets */
.btn-sm {
	padding: .35rem .6rem;
	font-size: .8125rem;
}
.btn-block, .btn.w-100 {
	display: block !important;
	width: 100% !important;
}

/* Link styled buttons map to MYDS tertiary */
.btn-link, .btn.btn-link, .myds-btn--tertiary {
	background: transparent !important;
	border: none !important;
	color: var(--primary) !important;
	padding: 0 !important;
}

/* Ensure outline styles still show focus ring using MYDS tokens */
.btn:focus-visible, .btn:focus {
	outline: 2px solid var(--fr) !important;
	outline-offset: 2px !important;
	box-shadow: 0 0 0 4px var(--fr-shadow) !important;
}

/* MYDS utility variants so views can use myds-* classes exclusively */
.myds-btn--sm {
	padding: .35rem .6rem;
	font-size: .8125rem;
}
.myds-btn--block {
	display: block !important;
	width: 100% !important;
}
.myds-btn--outline {
	background-color: transparent !important;
	color: var(--primary) !important;
	border: 1px solid var(--otl-primary) !important;
}

/* Links */
a {
	color: var(--primary);
}

/* Tables */
table {
	color: var(--txt-primary);
}

table thead th {
	background-color: var(--bg-muted);
	color: var(--txt-primary);
}

/* Badges / alerts */
.badge, .alert {
	background-color: var(--bg-surface);
	color: var(--txt-primary);
	border: 1px solid var(--otl-default);
}

/* Modals */
.modal-content {
	background-color: var(--bg-surface);
	color: var(--txt-primary);
}

/* Dropdown menus */
.dropdown-menu {
	background-color: var(--bg-surface);
	color: var(--txt-primary);
	border: 1px solid var(--otl-default);
}

/* Dropdown item text colour per MYDS (use txt-primary; disabled uses txt-disabled).
   Do not override items that are styled as myds-btn (e.g., destructive actions). */
.dropdown-menu .dropdown-item:not(.myds-btn) {
	color: var(--txt-primary) !important;
}
.dropdown-menu .dropdown-item:not(.myds-btn):hover,
.dropdown-menu .dropdown-item:not(.myds-btn):focus {
	color: var(--txt-primary) !important;
	background-color: var(--bg-muted) !important; /* washed */
}
.dropdown-menu .dropdown-item:not(.myds-btn).active,
.dropdown-menu .dropdown-item:not(.myds-btn):active {
	color: var(--txt-primary) !important;
	background-color: var(--bg-muted) !important;
}
.dropdown-menu .dropdown-item.disabled,
.dropdown-menu .dropdown-item:disabled {
	color: var(--txt-disabled) !important;
	pointer-events: none;
	opacity: 0.8;
}

/* myds table responsive tweaks */
.myds-table-responsive {
	border-radius: var(--radius-s);
	overflow: hidden;
	border: 1px solid var(--otl-default);
	background-color: var(--bg-surface);
}

/* Table styling consistent with MYDS tokens and dark mode */
.myds-table thead th {
	background-color: var(--bg-muted);
	color: var(--txt-primary);
	border-bottom: 1px solid var(--otl-default);
}
.myds-table tbody tr {
	border-bottom: 1px solid rgba(0,0,0,0.04);
}

/* Dark theme adjustments: increase contrast for separators and hovered rows */
[data-theme="dark"] .myds-table-responsive {
	background-color: var(--bg-surface);
	border: 1px solid rgba(255,255,255,0.04);
}
[data-theme="dark"] .myds-table tbody tr {
	border-bottom: 1px solid rgba(255,255,255,0.03);
}
[data-theme="dark"] .myds-table tbody tr:hover {
	background-color: rgba(255,255,255,0.02);
}

/* Dark mode table refinements for better legibility */
[data-theme="dark"] .myds-table-responsive {
	padding: .5rem; /* inset so table doesn't butt to container edge */
	border-radius: calc(var(--radius-s) + 2px);
	box-shadow: inset 0 0 0 1px rgba(255,255,255,0.01);
	background-color: rgba(255,255,255,0.01);
}

[data-theme="dark"] .myds-table {
	background-color: transparent;
}

[data-theme="dark"] .myds-table thead th {
	background-color: rgba(255,255,255,0.03);
	color: var(--txt-primary);
	border-bottom: 1px solid rgba(255,255,255,0.06);
}

/* stronger zebra striping in dark mode */
[data-theme="dark"] .table-striped>tbody>tr:nth-of-type(odd) {
	background-color: rgba(255,255,255,0.015);
}
[data-theme="dark"] .table-striped>tbody>tr:nth-of-type(even) {
	background-color: transparent;
}

[data-theme="dark"] .myds-table tbody tr:hover {
	background-color: rgba(255,255,255,0.035) !important;
}

[data-theme="dark"] .myds-table td, [data-theme="dark"] .myds-table th {
	border-color: rgba(255,255,255,0.02);
}

/* Unread notification visual indicator */
.notification-unread {
	position: relative;
	padding-left: 1rem !important;
}
.notification-unread::before {
	content: '';
	position: absolute;
	left: 0.5rem;
	top: 0.8rem;
	bottom: 0.8rem;
	width: 4px;
	border-radius: 2px;
	background: var(--primary);
}

[data-theme="dark"] .notification-unread::before {
	background: var(--primary);
}



/* Focus utilities */
.focus-ring {
	outline: 2px solid var(--fr) !important;
	outline-offset: 2px !important;
	box-shadow: 0 0 0 4px var(--fr-shadow) !important;
}

/* Small transition for theme swap */
:root, [data-theme="dark"] {
	transition: background-color 200ms ease, color 200ms ease;
}

h1,h2,h3,h4,h5,h6 {
	font-family: var(--font-heading);
	font-weight: 600;
}

/* Slightly larger tap targets for MYDS buttons */
.myds-btn { border-radius: var(--radius-s); padding: .5rem .875rem; }

/* Ensure dropdown items receive focus-visible styles in all browsers */
.dropdown-menu .dropdown-item:focus-visible {
	outline: 2px solid var(--fr) !important;
	outline-offset: 2px !important;
	box-shadow: 0 0 0 4px var(--fr-shadow) !important;
}
